if [ -e "$HOME/.functions/z.sh" ]; then
  . "$HOME/.functions/z.sh"
  function precmd () {
    _z --add "$(pwd -P)"
  }
fi

function rs {
  if [ -e bin/rails ]; then
    bin/rails server $@
  elif [ -e script/rails ]; then
    script/rails server $@
  else
    script/server $@
  fi
}

function rc {
  if [ -e script/rails ]; then
    script/rails console $@
  elif [ -e bin/rails ]; then
    bin/rails console $@
  else
    script/console $@
  fi
}

function rg {
  if [ -e script/rails ]; then
    script/rails generate $@
  elif [ -e bin/rails ]; then
    bin/rails generate $@
  else
    script/generate $@
  fi
}

function rake {
  if [ -e bin/rake ]; then
    bin/rake $@
  elif [ -e Gemfile ]; then
    bundle exec rake $@
  else
    command rake $@
  fi
}


# Opens a new terminal tab in the same working directory
function open_tab {
  osascript -e "
  tell application \"System Events\" to tell process \"Terminal\" to keystroke \"t\" using command down
  tell application \"Terminal\" to do script \"cd '$PWD' \" in selected tab of the front window    "
}

# Open as many new tabs as you want
# USAGE: nt 4 (will open 4 terminal tabs)
# If no argument is given, it will open one new terminal tab
function nt () {
  i=0;
  if [[ ! -z "$@" ]]
    then
    while [ $i -lt $1 ]; do
      open_tab
      let i+=1;
    done
  else
    open_tab
  fi
}

# Create a web server from the current directory
# usage: server <port>
#        # => server 8080
function server() {
  open "http://localhost:${1}" && python -m SimpleHTTPServer $1
}


function oldpr() {
  ref=$(git symbolic-ref HEAD 2> /dev/null)
  if [[ -n $ref ]]; then
    echo `git pull-request -h $1:${ref#refs/heads/}`
  fi
}

function clg(){
  `gb --merge master | grep -v master | xargs git branch -d`
}

function pr {
  bopen=0
  while getopts ":o" Option
  do
    case $Option in
      o ) bopen=1 ;;
    esac
  done
  echo $bopen
  if [ $bopen -eq 1 ]; then
    hub pull-request | open
  else
    hub pull-request
  fi
}
